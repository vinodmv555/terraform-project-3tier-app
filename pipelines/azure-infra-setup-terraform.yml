---
trigger: none
name: Setup ${parameters.environment} App Infra
appendCommitMessageToRunName: false 

parameters:
  - name: environment
    displayName: Select Environment
    type: string
    default: Development
    values:
      - Development
      - Acceptance 
      - Production 

variables:
  - name: env
    '${{ if eq(parameters.environment, ''Development'' ) }}':
      value: dev 
    '${{ if eq(parameters.environment, ''Acceptance'' ) }}':
      value: acc
    '${{ if eq(parameters.environment, ''Production'' ) }}':
      value: prd
  
  - name: backend_storage_rg 
    value: rg-terraform-backends
  - name: backend_storage_account
    value: terraformbackends286957
  - name: backend_storage_container
    value: terraform-backend-myapp
  - name: backend_storage_key
    value: $(env)-webapp.terraform.tfstate  

stages:
  - stage: Terraform_Validate 
    jobs:
      - job: Terrafrom_Validate 
        displayName: Validate Terraform
        continueOnError: false
        steps:
          - task: TerraformInstaller@1
            inputs:
              terraformVersion: 'latest'